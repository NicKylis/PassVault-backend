{
 "openapi":"3.0.0",
 "info":{
    "title":"Auth Router",
    "version":"1.0.0",
    "description":"API for managing passwords,favourites,sharing,and tracking usage."
 },
 "tags":[
    {
        "name":"Passwords",
        "description":"Password and sharing operations"
    }
 ],
 "paths":{
    "/passwords":{
        "post":{
            "summary":"Create a password",
            "tags":["Passwords"],
            "security":[{"BearerAuth":[]}],
            "requestBody":{
                "required":true,
                "content":{
                    "application/json":{
                        "schema":{ "$ref": "#/components/schema/PasswordCreate"}
                    }
                }
            },
            "responses":{
                "200":{
                    "description":"Passowrd created",
                    "content":{
                        "application/json":{
                            "schema":{"$ref": "#/components/schema/Password"}
                        }
                    }
                }
            }
        },
        "get":{
            "summary":"Get all passwords (owned + shared)",
            "tags":["Passwords"],
            "security":[{"BearerAuth":[]}],
            "responses":{
                "200":{
                    "description":"List of passwords",
                    "content":{
                        "application/json":{
                            "schema":{
                                "type":"object",
                                "properties":{
                                    "owned":{
                                        "types":"array",
                                        "item":{ "$ref": "#/components/schema/Password" }
                                    },
                                    "shared":{
                                        "type":"array",
                                        "item":{ "$ref": "#/components/schema/SharedPasswordEntry" }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "/passwords/{id}/favourite":{
      "patch":{
        "summary":"Toggle favourite (owner or shared)",
        "tags":["Passwords"],
        "security":[{ "BearerAuth": []}],
        "parameters":[
            {"name": "id", "in":"path", "required":true, "schema":{ "type": "string"}}
        ],
        "requestBody":{
            "content":{
                "application/json":{
                    "schema":{
                        "type":"object",
                        "properties":{
                            "shared":{ "type": "boolean", "example": false}
                        }
                    }
                }
            }
        },
        "responses":{
             "200":{
                "description":"Favourite toggled",
                "content":{
                    "application/json":{
                        "schema": { "$ref": "#/components/schema/FavouriteToggleResponse"}
                    }
                }
             },
             "403":{ "description": "Not allowed"}
        }
      }
    },
  "/passwords/{id}/use":{
    "patch":{
        "summary":"Mark password as used (owner or shared)",
        "tags": ["Passwords"],
        "security":[{ "BearerAuth":[]}],
        "parameters":[
            {"name": "id", "in":"path","required":true,"schema":{ "type":"string"}}
        ],
        "requestBody":{
            "content":{
                "application/json":{
                    "schema":{
                        "type":"object",
                        "properties":{ "shared": { "type":"boolean", "example":false}}
                    }
                }
            }
        },
        "responses":{
            "200":{
                "description":"Usage updated",
                "content":{
                    "application/json":{
                        "schema":{ "$ref": "#/components/schema/PasswordUseResponse"}
                    }
                }
            },
            "403": {"description": "Not allowed"}
        }
    }
  },

  "/passwords/shared/{id}":{
    "delete":{
        "summary":"Remove shared password from user's profile",
        "tags":["Passwords"],
        "security":[{"BearerAuth":[]}],
        "parameters":[
            { "name": "id", "in": "path", "required":true,"schema":{ "type": "string"}}
        ],
        "responses":{
            "200":{
                "description":"Shared password removed",
                "content":{
                    "application/json":{
                        "schema":{ "$ref": "#/components/schema/MessageResponse"}
                    }
                }
            }
        }
    }
  },
  "/passwords/{id}/share":{
    "post":{
        "summary": "Share a password with users (owner only)",
        "tags":["Passwords"],
        "security":[{ "BearerAuth": []}],
        "parameters":[
            { "name": "id", "in":"path", "required":true,"schema":{ "type":"string"}}
        ],
        "requestBody":{
            "required":true,
            "content":{
                "application/json":{
                    "schema":{ "$ref": "#/components/schema/ShareRequest"}
                }
            }
        },
        "responses":{
            "200":{
                "description":"Share results",
                "content":{
                    "application/json":{
                        "schema":{ "$ref":"#/components/schema/ShareResponse"}
                    }
                }
            },
            "403":{"description":"Not owner"}
        }
    }
  },
  "/passwords/{id}":{
    "put":{
        "summary":"Update password (owner only)",
        "tags":["Passwords"],
        "security":[{ "BearerAuth":[]}],
        "parameters":[
            { "name": "id", "in": "path","required":true,"schema":{ "type": "string"}}
        ],
        "requestBody":{
            "content":{
                "application/json":{ "schema": { "$ref": "#/components/schema/PasswordUpdate"}}
            }
        },
        "responses":{
            "200":{ "description": "Updated password", "content": {"application/json":{}}},
            "403":{ "description":"Not allowed"}
        }
    },
    "delete":{
        "summary":"Delete password (owner only)",
        "tags":["Passwords"],
        "security":[{ "BearerAuth":[]}],
        "parameters":[
            { "name": "id","in":"path","required":true,"schema":{ "type":"string"}}
        ],
        "responses":{
            "200":{
                "description":"Password deleted",
                "content":{
                    "application/json":{
                        "schema":{ "$ref": "#/components/schema/MessageResponse"}
                    }
                }
            }
        }
    }
  },
  "/passwords/{id}/shared-users":{
    "get":{
        "summary":"Get all users this password is shared with",
        "tags":["Passwords"],
        "security":[{ "BearerAuth":[]}],
        "parameters":[
            { "name": "id", "in":"path","required":true, "schema":{ "type":"string"}}
        ],
        "responses":{
            "200":{
                "description":"List of shard users",
                "content":{
                    "application/json":{
                        "schema":{
                            "type":"array",
                            "items":{ "$ref": "#/components/schema/SharedUserEntry"}
                        }
                    }
                }
            },
            "403":{ "description": "Not allowed"}
        }
    }
  }
 },
 "components":{
    "securitySchemes":{
        "BearerAuth":{
            "type":"http",
            "scheme": "bearer"
        }
    },
    "schema":{
        "Password":{
            "type":"object",
            "properties":{
                "id": {"type": "string"},
                "title":{ "type": "string"},
                "username":{ "type":"string"},
                "password":{ "type": "string"},
                "url":{ "type": "string"},
                "favourite":{ "type": "boolean"},
                "lastUsedAt":{ "type": "string", "format": "date-time"},
                "ownerId":{ "type":"string"}
            }
        },
        "PasswordCreate":{
            "type":"object",
            "properties":{
                "title":{ "type": "string"},
                "username":{ "type": "string"},
                "password":{ "type":"string"},
                "url":{ "type":"string"}
            }
        },
        "PasswordUpdate":{
            "type":"object",
            "properties":{
                "title":{ "type": "string"},
                "username":{ "type": "string"},
                "password":{ "type":"string"},
                "url":{ "type":"string"},
                "favourite":{ "type": "boolean"}
            }
        },
        "SharedPasswordEntry":{
            "type":"object",
            "properties":{
                "_id":{ "type": "string"},
                "title":{ "type": "string"},
                "username":{ "type": "string"},
                "password":{ "type":"string"},
                "url":{ "type":"string"},
                "favourite":{ "type": "boolean"},
                "lastUsedAt":{ "type": "string","format":"date-time"},
                "shared":{ "type":"boolean", "example":true},
                "sharedRecordId":{ "type":"string"}
            }
        },
        "FavouriteToggleResponse":{
            "type":"object",
            "properties":{
                "favourite":{ "type": "string"},
                "message":{"type":"string"}
            }
        },
        "PasswordUseResponse":{
            "type": "object",
            "properties":{
                "lastUsedAt":{ "type":"string", "format": "date-time"},
                "message":{ "type": "string"}
            }
        },
        "MessageResponse":{
            "type":"object",
            "properties":{
                "message":{ "type": "string"}
            }
        },
        "ShareRequest":{
            "type":"object",
            "properties":{
                "email":{
                    "type":"array",
                    "item":{ "type": "string", "format": "email"}
                }
            }
        },
        "ShareResponse":{
            "type":"object",
            "properties":{
                "message": { "type": "string", "example": "Share operation completed"},
                "results":{
                    "type":"array",
                    "items":{
                        "type":"object",
                        "properties":{
                            "email":{ "type":"string" },
                            "status":{ "type":"string","example": "success"},
                            "reason":{ "type": "string"},
                            "shareId":{ "type": "string"}
                        }
                    }
                }
            }
        },
        "SharedUserEntry":{
            "type":"object",
            "properties":{
                "sharedWithId":{
                    "type":"object",
                    "properties":{
                        "name":{ "type":"string"},
                        "email":{ "type":"string"}
                    }
                },
                "_id":{ "type": "string"},
                "passwordId":{ "type": "string"},
                "favourite":{ "type": "boolea"},
                "lastUsedAt":{ "type":"string", "format":"date-time"}
            }
        }
    }
 }
}